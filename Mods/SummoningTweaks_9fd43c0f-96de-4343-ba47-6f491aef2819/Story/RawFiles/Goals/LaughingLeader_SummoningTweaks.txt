Version 1
SubGoalCombiner SGC_AND
INITSECTION
// [BEGIN_NO_OSITOOLS]
SysActivateGoal("LLSUMMONINF_LegacyMode");
// [END_NO_OSITOOLS]
KBSECTION
//REGION LEGACY_SCRIPT
// [BEGIN_NO_OSITOOLS]
IF
SavegameLoading(_,_,_,_)
AND
NOT SysIsActive("LLSUMMONINF_LegacyMode")
THEN
SysActivateGoal("LLSUMMONINF_LegacyMode");
// [END_NO_OSITOOLS]

/* [OSITOOLS_ONLY]
IF
SavegameLoading(_,_,_,_)
AND
SysIsActive("LLSUMMONINF_LegacyMode")
THEN
SysCompleteGoal("LLSUMMONINF_LegacyMode");

// Cooldown Reset
IF
CharacterUsedSkill(_Player, _Skill, "summon", _)
AND
GlobalGetFlag("LLSUMMONINF_InstantSummonCooldownDisabled", 0)
AND
DB_IsPlayer(_Player)
AND
CharacterIsInCombat(_Player, 0)
THEN
NRD_SkillSetCooldown(_Player, _Skill, 0.0);
*/
//END_REGION

//REGION ADD_REMOVE_SKILL
PROC
LLSUMMONINF_AddSkill((CHARACTERGUID)_Player, (STRING)_Skill, (STRING)_AddedSkillFlag)
AND
CharacterHasSkill(_Player, _Skill, 0)
AND
ObjectGetFlag(_Player, _AddedSkillFlag, _Val)
AND
IntegerSubtract(1, _Val, _Notify)
THEN
ObjectSetFlag(_Player, _AddedSkillFlag, 0);
CharacterAddSkill(_Player, _Skill, _Notify);

PROC
LLSUMMONINF_RemoveSkill((CHARACTERGUID)_Player, (STRING)_Skill)
AND
CharacterHasSkill(_Player, _Skill, 1)
THEN
CharacterRemoveSkill(_Player, _Skill);
//END_REGION


//REGION EXTENDER_SUMMONING
/*
IF
CharacterStatusApplied(_Summon, "SUMMONING", _)
AND
CharacterIsSummon(_Summon, 1)
AND
CharacterGetOwner(_Summon, _Player)
AND
CharacterIsPlayer(_Player, 1)
AND
GetTemplate(_Summon, _Template)
AND
IsTagged(_Summon, "TOTEM", _IsTotem)
THEN
DB_LLSUMMONINF_SummonTemplates(_Template, _IsTotem);
SetVarString(_Player, "LLSUMMONINF_LastSummonTemplate", _Template);
LLSUMMONINF_OnSummonAdded(_Player, _Summon);

PROC
LLSUMMONINF_SummonTemplateAtPosition((CHARACTERGUID)_Player, (STRING)_Template, (REAL)_x, (REAL)_y, (REAL)_z, (REAL)_Lifetime)
AND
DB_LLSUMMONINF_SummonTemplates(_Template, _IsTotem)
THEN
NRD_ModCall("LLSummoningTweaks", "SummonTemplateAtPosition", (STRING)_Player, _Template, (STRING)_x, (STRING)_y, (STRING)_z, (STRING)_Lifetime, (STRING)_IsTotem);

PROC
LLSUMMONINF_SummonTemplateAtPosition((CHARACTERGUID)_Player, (STRING)_Template, (REAL)_x, (REAL)_y, (REAL)_z, (REAL)_Lifetime)
AND
DB_LLSUMMONINF_SummonTemplates(_Template, _IsTotem)
AND
CharacterGetLevel(_Player, _Level)
AND
NRD_Summon(_Player, (GUIDSTRING)_Template, _x, _y, _z, _Lifetime, _Level, _IsTotem, 1, _Summon)
AND
RealSum(_y, 2.0, _ty)
THEN
//PlayEffectAtPosition("RS3_FX_UI_Icon_SkipTurn_UsedScroll_01", _x, _ty, _z);
PlayEffect(_Summon, "RS3_FX_UI_Icon_SkipTurn_UsedScroll_01", "Dummy_OverheadFX");
PlayEffectAtPosition("LLSUMMONINF_Skills_InvokeContract_Cast_Summon_01", _x, _y, _z);
PlayEffectAtPosition("RS3_FX_Skills_Totem_Target_Nebula_01", _x, _y, _z);
*/
//END_REGION

//REGION SUMMON_EVENT_PROCS
/* [OSITOOLS_ONLY]
PROC
LLSUMMONINF_OnSummonAdded((CHARACTERGUID)_Player, (CHARACTERGUID)_Summon)
AND
GetUUID(_Player, _UUID)
THEN
NRD_ModCall("LLSummoningTweaks", "UpdateMaxSummons", _UUID);
*/

PROC
LLSUMMONINF_OnSummonAdded((CHARACTERGUID)_Player, (CHARACTERGUID)_Summon)
AND
CharacterIsPartyFollower(_Player, 0)
THEN
LLSUMMONINF_TryAddContract(_Player);

PROC
LLSUMMONINF_OnSummonAdded((CHARACTERGUID)_Player, (CHARACTERGUID)_Summon)
AND
DB_IsPlayer(_Player)
THEN
DB_LLSUMMONINF_Temp_ActiveSummons(_Player, _Summon);

PROC
LLSUMMONINF_OnSummonAdded((CHARACTERGUID)_Player, (CHARACTERGUID)_Summon)
AND
SysCount("DB_LLSUMMONINF_Temp_ActiveSummons", 2, _Count)
AND
_Count > 0
AND
NOT SysIsActive("LLSUMMONINF_TS_SummonTeleporting")
THEN
SysActivateGoal("LLSUMMONINF_TS_SummonTeleporting");

PROC
LLSUMMONINF_OnSummonAdded((CHARACTERGUID)_Player, (CHARACTERGUID)_Summon)
AND
NOT GlobalGetFlag("LLSUMMONINF_DismissSkillAutoAddingDisabled", 1)
THEN
LLSUMMONINF_AddSkill(_Player, "Target_LLSUMMONINF_DismissSummon", "LLSUMMONINF_AddedDismissSkillToSummoner");

PROC
LLSUMMONINF_OnSummonRemoved((CHARACTERGUID)_Player, (CHARACTERGUID)_Summon)
AND
SysCount("DB_LLSUMMONINF_Temp_ActiveSummons", 2, 0)
AND
SysIsActive("LLSUMMONINF_TS_SummonTeleporting")
THEN
SysCompleteGoal("LLSUMMONINF_TS_SummonTeleporting");
//END_REGION

//REGION SUMMONING_APPLIED
IF
CharacterStatusApplied(_Summon, "SUMMONING", _)
AND
IsTagged(_Summon, "TOTEM", 0)
AND
CharacterIsSummon(_Summon, 1)
AND
CharacterGetOwner(_Summon, _Player)
AND
CharacterIsPlayer(_Player, 1)
AND
GetTemplate(_Summon, _Template)
THEN
SetVarString(_Player, "LLSUMMONINF_LastSummonTemplate", _Template);
LLSUMMONINF_OnSummonAdded(_Player, _Summon);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "__Start"